# Name of the application.
name: Copilot-Studio-with-Azure-AI-Search
metadata:
  template: Copilot-Studio-with-Azure-AI-Search@0.0.1-beta
infra:
  provider: terraform
hooks:
  preprovision:
    shell: pwsh
    continueOnError: false
    interactive: false
    run: azd-hooks/preprovision.ps1
  postprovision:
    shell: pwsh
    continueOnError: false
    interactive: false
    secrets: 
      "openai_resource_id" : "openai_resource_id"
      "power_platform_environment_id" : "power_platform_environment_id"
    run: 
      
      src/scripts/deploy_power_platform_solution.ps1 -SolutionPath "src/powerplatform/GoldAgent.zip" -AISearchConnectionId $env:aisearch_connection_id -PowerPlatformEnvironmentId $env:power_platform_environment_id #This works 
      # src/scripts/deploy_power_platform_solution.ps1 -SolutionPath "src/powerplatform/GoldAgent.zip" -AISearchConnectionId "aisearch_connection_id" -PowerPlatformEnvironmentId "power_platform_environment_id" #TODO this doesn't work, figure out how to actually connect env vars
  predeploy:
    shell: pwsh
    continueOnError: false
    interactive: false
    run: azd-hooks/predeploy.ps1
  postdeploy:
    shell: pwsh
    continueOnError: false
    interactive: false
    run: azd-hooks/postdeploy.ps1
  prepackage:
    shell: pwsh
    continueOnError: false
    interactive: false
    run: azd-hooks/prepackage.ps1
  postpackage:
    shell: pwsh
    continueOnError: false
    interactive: false
    run: azd-hooks/postpackage.ps1
